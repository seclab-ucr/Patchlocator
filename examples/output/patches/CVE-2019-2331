commit 165fffbf94f706d0fd4b5bbb3675016b39e6c744
Author: Vatsal Bucha <vbucha@codeaurora.org>
Date:   Fri Mar 1 13:16:39 2019 +0530

    qdsp6v2: apr: check for packet size to header size comparison
    
    Check if packet size is large enough to hold the header.
    
    Change-Id: I7261f8111d8b5f4f7c181e469de248a732242d64
    Signed-off-by: Vatsal Bucha <vbucha@codeaurora.org>

diff --git a/drivers/soc/qcom/qdsp6v2/apr.c b/drivers/soc/qcom/qdsp6v2/apr.c
index b1afd02b49bf..8f5408725a3e 100644
--- a/drivers/soc/qcom/qdsp6v2/apr.c
+++ b/drivers/soc/qcom/qdsp6v2/apr.c
@@ -584,6 +584,12 @@ void apr_cb_func(void *buf, int len, void *priv)
 		pr_err("APR: Wrong paket size\n");
 		return;
 	}
+
+	if (hdr->pkt_size < hdr_size) {
+		pr_err("APR: Packet size less than header size\n");
+		return;
+	}
+
 	msg_type = hdr->hdr_field;
 	msg_type = (msg_type >> 0x08) & 0x0003;
 	if (msg_type >= APR_MSG_TYPE_MAX && msg_type != APR_BASIC_RSP_RESULT) {
